//@version=6
indicator("TradeBlocks Market Data Export", overlay=false)

// =============================================================================
// UNIVERSAL MARKET DATA EXPORT
// =============================================================================
// Purpose: Export raw OHLCV + VIX term structure for import into TradeBlocks
//
// Usage:
//   1. Apply to ANY chart on ANY timeframe
//      - Daily chart  → import to market.daily via import_market_csv
//      - Intraday chart (5m, 15m, etc.) → import to market.intraday
//   2. Set date range in TradingView
//   3. Right-click indicator pane -> "Export chart data..."
//   4. Import via: import_market_csv with column mapping
//
// Column mapping examples:
//   Daily:    { "time": "date", "open": "open", "high": "high", "low": "low", "close": "close" }
//   Context:  { "time": "date", "VIX_Open": "VIX_Open", "VIX_Close": "VIX_Close", ... }
//   Intraday: { "time": "date", "open": "open", "high": "high", "low": "low", "close": "close" }
//             (time HH:MM auto-extracted from Unix timestamp for intraday imports)
//
// Note: Enrichment pipeline computes all derived fields (RSI, ATR, Bollinger, etc.)
//       from raw OHLCV after import — no need to export them from TradingView.
// =============================================================================

// VIX term structure via request.security (returns na on intraday timeframes — safe to export)
float vixOpen    = request.security("CBOE:VIX",   timeframe.period, open)
float vixHigh    = request.security("CBOE:VIX",   timeframe.period, high)
float vixLow     = request.security("CBOE:VIX",   timeframe.period, low)
float vixClose   = request.security("CBOE:VIX",   timeframe.period, close)
float vix9dClose = request.security("CBOE:VIX9D", timeframe.period, close)
float vix3mClose = request.security("CBOE:VIX3M", timeframe.period, close)

// Export raw OHLCV (TradingView includes open/high/low/close as default columns
// in the export, but we plot them explicitly for clear column mapping)
plot(open,  "open",  display=display.data_window)
plot(high,  "high",  display=display.data_window)
plot(low,   "low",   display=display.data_window)
plot(close, "close", display=display.data_window)

// VIX data plots (daily timeframe: real values; intraday: na — harmless in export)
plot(vixOpen,    "VIX_Open",    display=display.data_window)
plot(vixHigh,    "VIX_High",    display=display.data_window)
plot(vixLow,     "VIX_Low",     display=display.data_window)
plot(vixClose,   "VIX_Close",   display=display.data_window)
plot(vix9dClose, "VIX9D_Close", display=display.data_window)
plot(vix3mClose, "VIX3M_Close", display=display.data_window)
