---
phase: 05-optimization-targets
plan: 01
type: execute
domain: react-forms
---

<objective>
Remove broken diversification optimization targets from the target dropdown while preserving working diversification constraints.

Purpose: Users can currently select diversification targets (minAvgCorrelation, minTailRisk, maxEffectiveFactors) that silently fail, returning NEGATIVE_INFINITY. This creates a poor user experience where analysis runs but produces invalid results.

Output: Clean target dropdown with only working options (8 targets), diversification constraints continue to work correctly.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/AUDIT-FINDINGS.md
@.planning/phases/01-audit-analysis/01-01-SUMMARY.md

**Key files:**
@components/walk-forward/period-selector.tsx
@lib/calculations/walk-forward-analyzer.ts
@lib/models/walk-forward.ts

**Background:**
From Phase 1 audit, diversification targets return NEGATIVE_INFINITY because computing correlation/tail risk for EACH parameter combination during grid search is computationally expensive. The code comment at line 676-678 explains: "They require computing correlation/tail risk for EACH parameter combination which is expensive. For now, they're used as constraints, not targets."

**Working targets (8):** netPl, profitFactor, sharpeRatio, sortinoRatio, calmarRatio, cagr, avgDailyPl, winRate
**Broken targets (3):** minAvgCorrelation, minTailRisk, maxEffectiveFactors

**Note:** Diversification CONSTRAINTS (enableCorrelationConstraint, enableTailRiskConstraint) work correctly and should NOT be touched. Only the optimization TARGETS are broken.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove broken diversification targets from dropdown</name>
  <files>components/walk-forward/period-selector.tsx</files>
  <action>
1. Remove the three diversification entries from TARGET_OPTIONS array (lines 57-60):
   - { value: "minAvgCorrelation", label: "Min Avg Correlation", group: "diversification" }
   - { value: "minTailRisk", label: "Min Tail Risk", group: "diversification" }
   - { value: "maxEffectiveFactors", label: "Max Effective Factors", group: "diversification" }

2. Remove the "diversification" option from the group type (line 45):
   - Change: group: "performance" | "risk-adjusted" | "diversification"
   - To: group: "performance" | "risk-adjusted"

3. Remove the SelectGroup for diversification targets in the dropdown (around lines 643-650):
   - Delete the entire SelectGroup block that filters by diversification group

4. Remove the `isDiversificationTarget` helper function (around line 73) since it's no longer needed

5. Remove the "Performance Floor" section that shows when diversification target is selected (around lines 824-929):
   - This entire conditional block starting with `{isDiversificationTarget(config.optimizationTarget) && (` should be removed

6. Clean up any dead imports if isDiversificationTarget was exported

DO NOT touch:
- The diversificationOpen state, diversificationConfig, or Diversification Constraints collapsible section
- The calculateDiversificationMetrics function in the analyzer
- Any constraint-related code (enableCorrelationConstraint, enableTailRiskConstraint)
  </action>
  <verify>
npm run typecheck passes
The period-selector.tsx file should have no TypeScript errors
  </verify>
  <done>
- TARGET_OPTIONS has 8 items (no diversification group)
- Target dropdown shows Performance (5) and Risk-Adjusted (3) groups only
- No "Performance Floor" section anywhere in the component
- isDiversificationTarget helper removed
- Diversification Constraints collapsible section unchanged
  </done>
</task>

<task type="auto">
  <name>Task 2: Clean up type definition</name>
  <files>lib/models/walk-forward.ts</files>
  <action>
Add a comment to the WalkForwardOptimizationTarget type explaining why diversification targets are kept in the type but not used:

At lines 12-15, add a comment:
```typescript
  // Diversification targets - kept for type compatibility but not exposed in UI
  // Computing diversification metrics per parameter combination is too expensive
  // Use diversification CONSTRAINTS instead (enableCorrelationConstraint, enableTailRiskConstraint)
  | 'minAvgCorrelation'
  | 'minTailRisk'
  | 'maxEffectiveFactors'
```

This preserves backward compatibility with any stored configs that might reference these targets, while documenting why they're not used.
  </action>
  <verify>
npm run typecheck passes
No type errors in walk-forward.ts
  </verify>
  <done>
- Comment explains why diversification targets exist in type but not UI
- Type remains backward compatible with existing stored analysis configs
- No breaking changes to type definitions
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Removed broken diversification targets from WFA configuration</what-built>
  <how-to-verify>
1. Run: npm run dev
2. Navigate to Walk-Forward Analysis page
3. Open the "Optimization Target" dropdown
4. Verify:
   - Only "Performance" group (Net Profit, Profit Factor, CAGR, Avg Daily P/L, Win Rate)
   - And "Risk-Adjusted" group (Sharpe Ratio, Sortino Ratio, Calmar Ratio)
   - NO "Diversification" group visible
5. Verify "Diversification Constraints" collapsible section still exists and works:
   - Should be able to enable Correlation Constraint and Tail Risk Constraint
   - These are CONSTRAINTS, not optimization targets
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run typecheck` passes
- [ ] `npm run lint` passes (or only pre-existing warnings)
- [ ] Target dropdown shows 8 options in 2 groups only
- [ ] No "Performance Floor" section appears in the UI
- [ ] Diversification Constraints section still works
</verification>

<success_criteria>
- Users cannot select broken diversification targets
- 8 working optimization targets available
- Diversification constraints continue to work
- No TypeScript errors
- Type definitions preserved for backward compatibility
</success_criteria>

<output>
After completion, create `.planning/phases/05-optimization-targets/05-01-SUMMARY.md`:

# Phase 5 Plan 01: Remove Broken Diversification Targets Summary

**[Substantive one-liner]**

## Performance
- Duration: X min
- Tasks: 3 (2 auto + 1 checkpoint)

## Accomplishments
- [List key outcomes]

## Files Created/Modified
- `components/walk-forward/period-selector.tsx` - Description
- `lib/models/walk-forward.ts` - Description

## Decisions Made
[Key decisions and rationale, or "None"]

## Issues Encountered
[Problems and resolutions, or "None"]

## Next Phase Readiness
Phase 5 complete, ready for Phase 6 (Results Summary View)
</output>
