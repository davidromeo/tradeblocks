---
phase: 02-parameter-ui-polish
plan: 01
type: execute
---

<objective>
Wrap parameter controls in a collapsible container matching the diversification pattern, and remove preset buttons.

Purpose: Achieve consistent container UX across all WFA configuration sections. Reduce visual clutter by defaulting to collapsed state.
Output: Parameter controls wrapped in Collapsible, preset buttons removed, collapsed by default.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-parameter-selection-ui/02-CONTEXT.md

**Source file:**
@components/walk-forward/period-selector.tsx

**Reference pattern (Diversification Constraints collapsible):**
Lines 863-1090 show the exact pattern to replicate:
- Collapsible with open state
- CollapsibleTrigger as button with border, hover, flex layout
- Title + Badge showing Active/Inactive status
- ChevronDown with rotate animation
- CollapsibleContent with pt-3 space-y-4

**Elements to modify:**
- Lines 138-151: presetButtons useMemo (DELETE)
- Line 725: preset button rendering (DELETE)
- Lines 703-752: Parameter Sweeps section (WRAP in Collapsible)
- Line 120-121: Add parametersOpen state alongside diversificationOpen

**Key pattern details:**
```tsx
// Collapsible state (line 120-121 area)
const [parametersOpen, setParametersOpen] = useState(false) // collapsed by default

// Collapsible wrapper (lines 863-886 pattern)
<Collapsible open={parametersOpen} onOpenChange={setParametersOpen}>
  <CollapsibleTrigger asChild>
    <button
      type="button"
      className="flex w-full items-center justify-between rounded-lg border border-border/40 px-4 py-3 text-left hover:bg-muted/50 transition-colors"
    >
      <div className="flex items-center gap-2">
        <p className="text-sm font-semibold">Parameter Sweeps</p>
        <Badge variant="outline" className="text-xs">
          {/* Active if any parameter enabled */}
        </Badge>
      </div>
      <ChevronDown className={cn("h-4 w-4 text-muted-foreground transition-transform", parametersOpen && "rotate-180")} />
    </button>
  </CollapsibleTrigger>
  <CollapsibleContent className="pt-3 space-y-4">
    {/* Existing parameter content moves here */}
  </CollapsibleContent>
</Collapsible>
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add parametersOpen state and wrap parameter controls in Collapsible</name>
  <files>components/walk-forward/period-selector.tsx</files>
  <action>
1. Add state for collapsible (near line 120-121 with other collapsible states):
   `const [parametersOpen, setParametersOpen] = useState(false)`

2. Find the "Parameter Sweeps" section (around line 690-752). It starts with the div containing "Parameter Sweeps" title with HoverCard and combination estimate badge.

3. Wrap the entire Parameter Sweeps section in a Collapsible matching the Diversification Constraints pattern:
   - Use the exact same button className from line 868
   - Title: "Parameter Sweeps"
   - Badge: Show "Active" if any parameter in extendedParameterRanges has enabled=true (4th element), otherwise "Inactive"
   - ChevronDown with rotate-180 when open
   - Move all existing content (combination badge, breakdown, warning, parameter grid) into CollapsibleContent

4. The Badge logic for active state:
   ```tsx
   {Object.values(extendedParameterRanges).some(([,,,enabled]) => enabled) ? "Active" : "Inactive"}
   ```

5. Keep the HoverCard help icon in the trigger alongside the title (same pattern as diversification).

DO NOT change any parameter control logic, just wrap in the collapsible pattern.
  </action>
  <verify>npm run typecheck passes. File structure matches Diversification Constraints pattern.</verify>
  <done>Parameter controls wrapped in Collapsible with collapsed default state, Active/Inactive badge based on enabled parameters.</done>
</task>

<task type="auto">
  <name>Task 2: Remove preset buttons</name>
  <files>components/walk-forward/period-selector.tsx</files>
  <action>
1. Delete the presetButtons useMemo (lines 138-151):
   ```tsx
   const presetButtons = useMemo(
     () =>
       Object.entries(presets ?? WALK_FORWARD_PRESETS).map(([key, preset]) => (
         ...
       )),
     [presets, applyPreset]
   )
   ```

2. Delete the preset button rendering (line 725):
   ```tsx
   <div className="flex flex-wrap gap-2 text-xs text-muted-foreground">{presetButtons}</div>
   ```

3. Remove the `presets` import from useWalkForwardStore if it's no longer used anywhere (check first):
   ```tsx
   const presets = useWalkForwardStore((state) => state.presets)
   ```

4. Remove the `applyPreset` import if no longer used:
   ```tsx
   const applyPreset = useWalkForwardStore((state) => state.applyPreset)
   ```

DO NOT remove WALK_FORWARD_PRESETS from imports if other code uses it. Only remove unused variables.
  </action>
  <verify>npm run typecheck passes. No ESLint warnings about unused variables. Preset buttons no longer render.</verify>
  <done>Preset buttons removed, unused store selectors cleaned up.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Parameter controls wrapped in collapsible container, preset buttons removed</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Navigate to Walk-Forward Analysis page with a block selected
    3. Verify: Parameter Sweeps section appears collapsed by default
    4. Click the Parameter Sweeps header - verify it expands with smooth animation
    5. Verify: Badge shows "Active" or "Inactive" based on enabled parameters
    6. Verify: ChevronDown rotates when expanded
    7. Verify: Conservative/Moderate/Aggressive preset buttons are GONE
    8. Verify: All parameter controls (checkboxes, sliders, inputs) work as before
    9. Compare visual style to Diversification Constraints section - should match exactly
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run typecheck` passes
- [ ] `npm run lint` passes (no unused variable warnings)
- [ ] Parameter Sweeps section has Collapsible wrapper
- [ ] Default state is collapsed
- [ ] Badge shows Active/Inactive correctly
- [ ] Preset buttons are removed
- [ ] Visual style matches Diversification Constraints
</verification>

<success_criteria>

- Parameter controls wrapped in Collapsible matching diversification pattern
- Collapsed by default
- Active/Inactive badge based on enabled parameters
- Preset buttons removed
- No TypeScript or lint errors
- Human verification approved
</success_criteria>

<output>
After completion, create `.planning/phases/02-parameter-selection-ui/02-01-SUMMARY.md`:

# Phase 2 Plan 1: Parameter UI Polish Summary

**[One-liner describing what shipped]**

## Accomplishments

- Wrapped parameter controls in Collapsible container
- Matched diversification constraints visual pattern
- Removed preset buttons (conservative/moderate/aggressive)
- Default to collapsed state

## Files Created/Modified

- `components/walk-forward/period-selector.tsx` - Added Collapsible wrapper, removed presets

## Decisions Made

[Any decisions made during implementation]

## Issues Encountered

[Any issues and resolutions]

## Next Step

Phase 2 complete, ready for Phase 3 (Input Validation Fixes)
</output>
