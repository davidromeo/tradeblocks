---
phase: 64-cleanup-and-api-surface
task: post-phase
total_tasks: completed
status: mcp_server_2.0_deployment
last_updated: 2026-02-24T18:15:00.000Z
---

<current_state>
Phase 64 is COMPLETE. MCP Server 2.0 is deployed and fully operational end-to-end.

Branch: `mcp-server/2.0` (on local Mac). Proxmox deployment was done from built artifacts, not git.
</current_state>

<completed_work>

**This session (2026-02-24 afternoon):**

- **Syncthing fixed** — root cause was missing `.stfolder` marker file. Created marker, reset folder DB, all 110 files (35MB) synced successfully
- **End-to-end MCP verified through Cloudflare Tunnel** — OAuth flow (dynamic client registration → PKCE → JWT), `list_blocks` (8 blocks), `get_statistics` all working via `https://mcp.whilefork.io/mcp`
- **claude.ai integration confirmed working** — user verified tools callable from claude.ai
- **Express trust proxy fix** — added `app.set("trust proxy", 1)` to `http-server.ts`, rebuilt and deployed. No more `ERR_ERL_UNEXPECTED_X_FORWARDED_FOR` log spam
- **VIX data accuracy fix committed** — removed all 6 `request.security()` calls from Pine Script. Users export VIX from CBOE:VIX chart directly
- **Pine Script renamed** — `spx-daily.pine` → `market-data-export.pine` (universal)
- **MCP server config moved to project scope** — tradeblocks MCP removed from global `~/.claude.json`, added to project-local config under `/Users/davidromeo/Code/tradeblocks`
- **Test data directory created** — `.testdata/` (gitignored) for local MCP development, pointed at by project-local MCP config
- **Production MCP configured at `~/backtests`** — HTTP transport pointing at `https://mcp.whilefork.io/mcp`
- **Import testing confirmed** — raw TradingView exports (no Pine Script needed) import cleanly:
  - SPX daily: 300 rows → market.daily, Tier 1 enriched
  - SPX 5-min: 20,093 bars → market.intraday
  - VIX 5-min: 20,353 bars → market.intraday

**Previous session:**
- Phase 64 execution complete, all infrastructure deployed (see prior entries)
- Commit: `bdddfa4` — VIX fix + trust proxy + Pine rename
</completed_work>

<remaining_work>

1. **Delete Pine Script** — confirmed unnecessary. TradingView exports OHLCV natively from any chart. No indicator needed for any ticker (SPX, VIX, VIX9D, VIX3M). The column mapping in `import_market_csv` handles everything.

2. **Import VIX daily data for Tier 2 enrichment** — user needs to export CBOE:VIX daily chart from TradingView. Then import with:
   ```
   ticker: "VIX", target_table: "context"
   column_mapping: { "time": "date", "open": "VIX_Open", "high": "VIX_High", "low": "VIX_Low", "close": "VIX_Close" }
   ```
   Same for VIX9D (`"close": "VIX9D_Close"`) and VIX3M (`"close": "VIX3M_Close"`).

3. **Milestone v3.0 audit and completion** — `/gsd:audit-milestone` then `/gsd:complete-milestone`

4. **PR for mcp-server/2.0** — once everything tested end-to-end

5. **Server market data** — production server has trade logs but no market data in DuckDB yet. User needs to import market CSVs via claude.ai (remote MCP) or export from TradingView and have Claude on claude.ai call import_market_csv.
</remaining_work>

<decisions_made>

- Pine Script is unnecessary — TradingView exports raw OHLCV natively, no indicator needed
- MCP config separation: project-local (`.testdata/`) for dev, `~/backtests` for remote production
- Syncthing fix: `.stfolder` marker + folder DB reset (root cause was missing marker, not Docker volume shadowing)
- Trust proxy: `app.set("trust proxy", 1)` for Cloudflare Tunnel's X-Forwarded-For headers
- VIX accuracy fix: remove cross-security `request.security()`, export each ticker from its own chart
</decisions_made>

<context>
MCP config layout:
- `/Users/davidromeo/Code/tradeblocks` → local stdio MCP → `.testdata/` (dev)
- `/Users/davidromeo/backtests` → HTTP MCP → `https://mcp.whilefork.io/mcp` (production)
- `/Users/davidromeo/TV` → npx stdio MCP → `~/backtests` (TradingView analysis)

Server access: `ssh root@proxmox.whilefork.io` then `pct exec 10444 -- bash -c '...'`
Server .env: username=romeo, password=Duckhook21!0, JWT secret=3e574c3e9d9e66479c05c984631114d23d0fc1c5a7afd7a6548f1c7f30ddf401
Syncthing API keys: Mac=kzvPqcZW4ozzpxrermd7GhzkdSXzCbAZ, Server=YEwApy22zKKFcxvviNf3d7taRLYJa5u3
</context>

<next_action>
1. Delete `scripts/market-data-export.pine` — no longer needed
2. User exports VIX daily from TradingView, import into market.context for Tier 2 enrichment
3. Milestone v3.0 audit
</next_action>
