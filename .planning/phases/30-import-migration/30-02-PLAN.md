---
phase: 30-import-migration
plan: 02
type: execute
---

<objective>
Update Next.js app imports from path aliases to workspace package imports.

Purpose: Enable Next.js app to import from @tradeblocks/lib instead of @/lib/* path aliases.
Output: All app/ and components/ files using clean @tradeblocks/lib imports.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./30-02-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-import-migration/30-01-SUMMARY.md

**Key files from Phase 29:**
@packages/lib/index.ts

**Current state:**
- 127 files in app/ and components/ use `@/lib/*` imports
- Phase 29 added `"@/lib/*": ["./packages/lib/*"]` to root tsconfig.json for backward compatibility
- @tradeblocks/lib workspace package is available via node_modules symlink

**Migration pattern:**
- `import { X } from '@/lib/models'` → `import { X } from '@tradeblocks/lib'`
- `import { Y } from '@/lib/calculations'` → `import { Y } from '@tradeblocks/lib'`
- All exports consolidated to @tradeblocks/lib barrel

**Note:** This is mechanical bulk find/replace. No logic changes.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update app/ directory imports</name>
  <files>app/**/*.ts, app/**/*.tsx (~12 files)</files>
  <action>
Update all `@/lib/*` imports in the app/ directory:

1. Find all files:
   ```bash
   grep -r "@/lib/" app --include="*.ts" --include="*.tsx" -l
   ```

2. For each file, replace imports:
   - `import { X } from '@/lib/models'` → `import { X } from '@tradeblocks/lib'`
   - `import { Y } from '@/lib/stores'` → `import { Y } from '@tradeblocks/lib'`
   - `import { Z } from '@/lib/calculations/portfolio-stats'` → `import { Z } from '@tradeblocks/lib'`
   - etc.

3. If a file has multiple @/lib/* imports, combine into single import:
   ```typescript
   // Before:
   import { Trade } from '@/lib/models'
   import { calculateStats } from '@/lib/calculations'

   // After:
   import { Trade, calculateStats } from '@tradeblocks/lib'
   ```

**Warning:** Some files may import specific deep paths like `@/lib/calculations/portfolio-stats`. Check packages/lib barrel exports to ensure all needed exports are available. If not, the submodule barrel export (e.g., packages/lib/calculations/index.ts) should already re-export.
  </action>
  <verify>
- `grep -r "@/lib/" app` returns no matches
- TypeScript compiles without errors for app files
  </verify>
  <done>All app/ files use @tradeblocks/lib imports</done>
</task>

<task type="auto">
  <name>Task 2: Update components/ directory imports</name>
  <files>components/**/*.ts, components/**/*.tsx (~115 files)</files>
  <action>
Update all `@/lib/*` imports in the components/ directory:

1. Find all files:
   ```bash
   grep -r "@/lib/" components --include="*.ts" --include="*.tsx" -l
   ```

2. Apply same migration pattern as Task 1:
   - `import { X } from '@/lib/...'` → `import { X } from '@tradeblocks/lib'`
   - Combine multiple lib imports into single import statement

3. This is the bulk of the work (~115 files). Use sed or programmatic approach:
   ```bash
   # Pattern to apply (conceptually):
   # Replace: from '@/lib/...' with from '@tradeblocks/lib'
   ```

**Important considerations:**
- Preserve non-lib imports (e.g., `@/components/ui/*` should NOT change)
- Only modify imports that reference `@/lib/`
- Maintain import ordering/formatting conventions
  </action>
  <verify>
- `grep -r "@/lib/" components` returns no matches
- TypeScript compiles: `npm run typecheck` (or equivalent)
  </verify>
  <done>All components/ files use @tradeblocks/lib imports</done>
</task>

<task type="auto">
  <name>Task 3: Verify full application compiles</name>
  <files>None (verification only)</files>
  <action>
Run full TypeScript compilation to verify all imports resolve:

1. Run typecheck:
   ```bash
   npm run typecheck
   ```
   Or if no typecheck script:
   ```bash
   npx tsc --noEmit
   ```

2. Run build to verify bundling works:
   ```bash
   npm run build
   ```

3. If any errors, identify and fix:
   - Missing exports: Add to packages/lib barrel exports
   - Type mismatches: Verify re-exports preserve types correctly
   - Circular dependencies: Rare, but check if errors mention cycles
  </action>
  <verify>
- `npm run typecheck` passes (or `npx tsc --noEmit`)
- `npm run build` succeeds
  </verify>
  <done>Full application compiles and builds successfully with @tradeblocks/lib imports</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `grep -r "@/lib/" app components` returns no matches
- [ ] `npm run typecheck` passes
- [ ] `npm run build` succeeds
- [ ] No new TypeScript errors introduced
</verification>

<success_criteria>

- All app/ and components/ files use @tradeblocks/lib
- TypeScript compilation passes
- Next.js build succeeds
- Ready for Phase 31 cleanup
</success_criteria>

<output>
After completion, create `.planning/phases/30-import-migration/30-02-SUMMARY.md`:

# Phase 30 Plan 02: Next.js App Import Migration Summary

**[One-liner describing what shipped]**

## Accomplishments
- Updated [N] files in app/ to use @tradeblocks/lib
- Updated [N] files in components/ to use @tradeblocks/lib
- Verified TypeScript and build pass

## Files Created/Modified
- `app/**/*.ts(x)` - Import updates
- `components/**/*.ts(x)` - Import updates

## Decisions Made
[Key decisions and rationale, or "None"]

## Issues Encountered
[Problems and resolutions, or "None"]

## Next Step
Phase 30 complete, ready for Phase 31: cleanup-verification
</output>
