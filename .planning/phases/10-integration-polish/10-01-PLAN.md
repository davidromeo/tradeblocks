---
phase: 10-integration-polish
plan: 01
type: execute
---

<objective>
Add pre-run configuration guidance to help users understand configuration tradeoffs before running analysis.

Purpose: Prevent the "bad config → bad results → blame strategy" loop by surfacing configuration issues upfront (ISS-004).
Output: Configuration card with contextual guidance that helps users set appropriate window sizes and parameter ranges before running.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/ISSUES.md
@.planning/phases/08-interpretation-guidance/08-03-SUMMARY.md

@components/walk-forward/period-selector.tsx
@lib/calculations/walk-forward-interpretation.ts

**Prior decisions affecting this plan:**
- Phase 08-03: Added configuration observations to Analysis tab (post-run). ISS-004 is about PRE-run guidance.
- Use "info" severity for informational, "warning" for actionable (established pattern)
- Use HoverCard pattern for detailed explanations (established in period-selector.tsx)

**Tech available:**
- Existing ConfigurationObservation pattern from walk-forward-interpretation.ts
- HoverCard/Alert components for displaying guidance
- Window configuration inputs already exist with tooltips
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add pre-run configuration validation function</name>
  <files>lib/calculations/walk-forward-interpretation.ts</files>
  <action>Add `validatePreRunConfiguration` function that checks:

  1. **Short window warning**: If inSampleDays < 21, warn that short windows may amplify noise
  2. **Aggressive IS/OOS ratio**: If inSampleDays/outOfSampleDays < 2, note that typical ratio is 2:1 to 4:1
  3. **Very long windows**: If inSampleDays > 90, note that longer windows may include stale market regimes
  4. **Low trade requirements**: If minInSampleTrades < 10 OR minOutOfSampleTrades < 5, warn insufficient trades produce unreliable statistics

  Return array of `ConfigurationObservation` objects (reuse existing interface from detectConfigurationObservations).

  This is a pure function taking `WalkForwardConfig` (no results needed - it runs BEFORE analysis).

  **AVOID**: Don't duplicate logic from detectConfigurationObservations - that function checks config IN CONTEXT of results. This function checks config BEFORE any results exist.</action>
  <verify>Add unit test in tests/unit/walk-forward-interpretation.test.ts verifying each warning triggers at appropriate thresholds</verify>
  <done>Function exists, returns appropriate warnings for edge configurations, unit tests pass</done>
</task>

<task type="auto">
  <name>Task 2: Display pre-run guidance in Configuration card</name>
  <files>components/walk-forward/period-selector.tsx</files>
  <action>Import and use validatePreRunConfiguration to show guidance BEFORE the user runs:

  1. Call validatePreRunConfiguration with current config state
  2. Display warnings/info in an Alert component below the window configuration inputs
  3. Only show when there are observations to display
  4. Use same styling pattern as Analysis tab (slate for info, amber for warning)
  5. Place between window configuration section and Strategy Filter section

  **Styling:** Use Alert component with:
  - variant="default" for info (slate)
  - variant="warning" for warnings (amber) - if this variant doesn't exist, use className overrides

  **AVOID**: Don't block the Run button - these are guidance, not hard errors. Users may have valid reasons for unusual configurations.</action>
  <verify>npm run lint passes, visual inspection shows guidance appears when thresholds are breached</verify>
  <done>Configuration card shows contextual guidance for short windows, aggressive ratios, and low trade requirements</done>
</task>

<task type="auto">
  <name>Task 3: Review and adjust auto-configuration defaults</name>
  <files>lib/stores/walk-forward-store.ts</files>
  <action>Review calculateAutoConfig function to ensure defaults don't consistently trigger warnings:

  **Current bounds (potentially problematic):**
  - Minimum 14d IS / 7d OOS → triggers "short window" warning (< 21d)
  - Very low frequency: minInSampleTrades = 4 → triggers "low trades" warning (< 10)

  **Adjustments to consider:**
  1. Raise minimum IS from 14 to 21 days (avoids short window warning)
  2. For low/very-low frequency, show a note in the auto-config Alert that these are minimal viable windows due to trade frequency
  3. Optionally: Add a flag to distinguish "auto-configured due to low data" vs "user-chosen" configs

  **Decision guidance:**
  - If user has very low frequency data, short windows may be NECESSARY to get any analysis
  - Don't raise minimums so high that low-frequency traders can't run WFA at all
  - Instead: When auto-config produces values that trigger warnings, acknowledge it in the auto-config Alert

  **Implementation:**
  1. Check if auto-config produced values that would trigger warnings
  2. If so, modify the autoConfigApplied Alert to explain: "Windows adjusted for your trading frequency. Shorter windows may amplify noise, but are needed to capture sufficient trades."
  3. Consider adding `autoConfigReason: 'low-frequency' | 'normal'` to state

  **AVOID**: Don't make changes that prevent low-frequency traders from using WFA. The warnings should inform, not block.</action>
  <verify>Auto-configured values for various trade frequencies make sense, low-frequency config explains tradeoffs in Alert</verify>
  <done>Auto-configuration acknowledges when it's constrained by low trade frequency, provides appropriate context</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run lint` passes
- [ ] `npm test` passes
- [ ] Short window (e.g., 14 days IS) shows warning
- [ ] Aggressive ratio (e.g., 14:14 IS:OOS) shows info note
- [ ] Low trade requirements (e.g., min IS trades = 5) shows warning
- [ ] Normal configurations (e.g., 45:15 IS:OOS, min 15 trades) show no warnings
- [ ] Auto-config for low-frequency trading explains tradeoffs
</verification>

<success_criteria>
- validatePreRunConfiguration function implemented with unit tests
- Configuration card displays contextual pre-run guidance
- Guidance helps users before they run, not after
- No blocking behavior - guidance is informational
- Auto-configuration acknowledges constraints for low-frequency data
- ISS-004 resolved
</success_criteria>

<output>
After completion, create `.planning/phases/10-integration-polish/10-01-SUMMARY.md`
</output>
