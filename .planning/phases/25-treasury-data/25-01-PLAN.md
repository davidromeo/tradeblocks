---
phase: 25-treasury-data
plan: 01
type: tdd
---

<objective>
Create embedded historical Treasury rate data and lookup utility for date-based risk-free rate calculations.

Purpose: Enable accurate Sharpe/Sortino calculations by using the actual 3-month T-bill rate for each trade date instead of a fixed 2% assumption.
Output: Static data file with ~3,000 daily rates (2013-2025) and a lookup function with fallback behavior.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/tdd.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Relevant source files:**
@lib/utils/time-conversions.ts (example utility pattern)

**From milestone planning:**
- Data source: US Treasury Daily Bill Rates Archive (https://home.treasury.gov/resource-center/data-chart-center/interest-rates/daily-treasury-rate-archives)
- Rate type: 3-month T-bill (industry standard proxy for risk-free rate)
- Date range: 2013-01-01 to 2025-12-31 (or latest available)
- Fallback: Last known rate for dates outside range
- Format: TypeScript Record<string, number> for O(1) lookup by date string (YYYY-MM-DD)

**Key decisions:**
- No external API calls at runtime (local-only principle)
- Annual updates needed (document in CLAUDE.md)
- Rates stored as annual percentages (e.g., 4.32 = 4.32% annual)
</context>

<feature>
  <name>Risk-Free Rate Lookup Utility</name>
  <files>lib/data/treasury-rates.ts, lib/utils/risk-free-rate.ts, tests/unit/risk-free-rate.test.ts</files>
  <behavior>
    getRiskFreeRate(date: Date) returns the annual risk-free rate as a percentage:

    Cases:
    - Date in range (2020-03-15) → exact rate for that date (or nearest prior trading day)
    - Date before range (2010-01-01) → earliest available rate (fallback)
    - Date after range (2030-01-01) → latest available rate (fallback)
    - Weekend/holiday (no data) → most recent prior trading day's rate

    Helper functions:
    - getEarliestRateDate() → Date of first available rate
    - getLatestRateDate() → Date of last available rate
    - getRateDataRange() → { start: Date, end: Date }
  </behavior>
  <implementation>
    1. Create lib/data/treasury-rates.ts with TREASURY_RATES constant (Record<string, number>)
       - Keys: "YYYY-MM-DD" format
       - Values: annual rate as percentage (e.g., 0.05 for 0.05%, 4.32 for 4.32%)

    2. Create lib/utils/risk-free-rate.ts with:
       - getRiskFreeRate(date: Date): number
       - Helper to format date to YYYY-MM-DD string
       - Binary search or linear scan backward for missing dates (weekends/holidays)
       - Export metadata functions for range info

    3. Data acquisition approach:
       - Download CSV from Treasury archive for 2013-2023
       - Download current year data
       - Convert to TypeScript constant with a script or manual formatting
       - The 3-month column is "4 wk bank discount" or similar - use the "3 Mo" column
  </implementation>
</feature>

<verification>
- [ ] `npm test -- tests/unit/risk-free-rate.test.ts` passes all cases
- [ ] `npm run build` succeeds without TypeScript errors
- [ ] Rate lookup returns reasonable values (0-20% range)
- [ ] Fallback behavior works for out-of-range dates
</verification>

<success_criteria>
- TREASURY_RATES data file exists with ~3,000 entries
- getRiskFreeRate() function works for any date
- Tests cover: in-range date, before-range, after-range, weekend date
- All 2-3 TDD commits present (test → implementation → optional refactor)
</success_criteria>

<output>
After completion, create `.planning/phases/25-treasury-data/25-01-SUMMARY.md`:

# Phase 25 Plan 01: Treasury Data Summary

**[One-liner describing what shipped]**

## TDD Cycle

### RED
- What test was written
- Why it failed (no implementation yet)

### GREEN
- What implementation made it pass

### REFACTOR
- What cleanup was done (if any)

## Files Created/Modified

- `lib/data/treasury-rates.ts` - Static rate data (~3,000 entries)
- `lib/utils/risk-free-rate.ts` - Lookup utility
- `tests/unit/risk-free-rate.test.ts` - Test suite

## Data Stats

- Date range: [earliest] to [latest]
- Number of entries: X
- File size: ~XXkb

## Commits

- test(25-01): add failing tests for risk-free rate lookup
- feat(25-01): implement treasury rate data and lookup utility
- [optional] refactor(25-01): ...

## Next Step

Ready for Phase 26: Core Calculations
</output>
