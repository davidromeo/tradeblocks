---
phase: 14-multi-platform-agent-skills
plan: "02"
type: execute
domain: agent-skills
---

<objective>
Create comparison and portfolio skills: tradeblocks-compare, tradeblocks-portfolio, and tradeblocks-optimize.

Purpose: Enable agents to help users compare strategies, make portfolio decisions, and optimize backtests.
Output: Three working SKILL.md files with supporting references.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-multi-platform-agent-skills/14-RESEARCH.md
@.planning/phases/14-multi-platform-agent-skills/14-CONTEXT.md
@.planning/phases/14-multi-platform-agent-skills/14-01-SUMMARY.md

**Prior work (14-01):** Created health-check, wfa, and risk skills.

**Remaining skills from CONTEXT.md:**
- Performance comparison (backtest vs actual, strategy vs strategy, period vs period)
- Portfolio addition decision (should this strategy be added?)
- Single backtest optimization (finding best parameters via Report Builder queries)

**Available MCP Tools:**
- compare_backtest_vs_actual: Compare theoretical vs live performance
- calculate_correlation: Assess strategy correlations
- get_period_returns: Period-over-period performance
- run_filtered_query, aggregate_by_field: Data exploration for optimization
- All analysis tools from 14-01
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create tradeblocks-compare skill</name>
  <files>packages/agent-skills/tradeblocks-compare/SKILL.md, packages/agent-skills/tradeblocks-compare/references/scaling.md</files>
  <action>
Create performance comparison skill:

SKILL.md structure:
- Frontmatter: name=tradeblocks-compare, description includes "compare strategies", "backtest vs actual", "performance comparison"
- Prerequisites: MCP server, one or more blocks
- Process (5 steps):
  1. Identify comparison type (ask user):
     - Backtest vs Actual (same strategy, different execution)
     - Strategy vs Strategy (two different strategies)
     - Period vs Period (same strategy, different time ranges)
  2. For Backtest vs Actual:
     - Use compare_backtest_vs_actual
     - Explain scaling modes (raw, perContract, toReported)
     - Show side-by-side metrics
  3. For Strategy vs Strategy:
     - Load both strategies (get_statistics for each)
     - Calculate correlation (calculate_correlation)
     - Compare key metrics
  4. For Period vs Period:
     - Use get_period_returns or run_filtered_query with date filters
     - Show period-specific performance
  5. Interpret differences:
     - Highlight significant divergences
     - Suggest causes (slippage, market regime, position sizing)
     - Recommend next steps

references/scaling.md:
- What is scaling and why it matters
- Raw vs perContract vs toReported explained
- When to use each mode
- Common pitfalls in backtest vs actual comparison
  </action>
  <verify>ls packages/agent-skills/tradeblocks-compare/ shows SKILL.md and references/</verify>
  <done>SKILL.md handles three comparison types with appropriate tools; scaling.md explains comparison concepts</done>
</task>

<task type="auto">
  <name>Task 2: Create tradeblocks-portfolio skill</name>
  <files>packages/agent-skills/tradeblocks-portfolio/SKILL.md, packages/agent-skills/tradeblocks-portfolio/references/correlation.md, packages/agent-skills/tradeblocks-portfolio/references/diversification.md</files>
  <action>
Create portfolio addition decision skill:

SKILL.md structure:
- Frontmatter: name=tradeblocks-portfolio, description includes "portfolio decision", "add strategy", "diversification", "correlation analysis"
- "What This Skill Does" section: Helps decide if adding a new strategy improves or degrades the portfolio
- Prerequisites: MCP server, existing portfolio block(s) + candidate strategy block
- Process (5 steps):
  1. Identify context:
     - Which strategy is the candidate?
     - What's the current portfolio composition?
  2. Run correlation analysis (calculate_correlation):
     - Candidate vs each existing strategy
     - Interpret: low correlation = good diversification
  3. Assess candidate standalone (get_statistics):
     - Is it profitable on its own?
     - What's its risk profile?
  4. Combined impact assessment:
     - Would adding this increase overall Sharpe?
     - Does it reduce max drawdown through diversification?
     - Or does it add correlated risk?
  5. Recommendation:
     - ADD (low correlation, profitable, improves portfolio)
     - CONSIDER (mixed signals, needs more analysis)
     - SKIP (high correlation or poor standalone metrics)

references/correlation.md:
- Correlation types (Pearson vs Kendall's tau)
- Why Kendall's tau is better for trading returns
- Interpreting correlation values
- Hidden correlation (tail correlation)

references/diversification.md:
- Why diversification matters
- Correlation â‰  diversification (they can diverge)
- Portfolio allocation considerations
- Common diversification mistakes
  </action>
  <verify>ls packages/agent-skills/tradeblocks-portfolio/ shows SKILL.md and references/</verify>
  <done>SKILL.md guides portfolio decisions with correlation analysis; references explain correlation and diversification</done>
</task>

<task type="auto">
  <name>Task 3: Create tradeblocks-optimize skill</name>
  <files>packages/agent-skills/tradeblocks-optimize/SKILL.md, packages/agent-skills/tradeblocks-optimize/references/optimization.md</files>
  <action>
Create backtest optimization skill using Report Builder tools:

SKILL.md structure:
- Frontmatter: name=tradeblocks-optimize, description includes "optimize backtest", "find best parameters", "trade analysis", "performance patterns"
- "What This Skill Does" section: Explores trade data to find patterns and optimal parameters (time of day, DTE, delta, etc.)
- Prerequisites: MCP server, block with enriched trade data
- Process (5 steps):
  1. Identify optimization goal:
     - Best entry time? (hourOfDay, dayOfWeek)
     - Optimal DTE? (dte field)
     - Delta sweet spot? (delta field)
     - Market condition filters? (vix, spy levels)
  2. Explore available fields (list_available_fields):
     - Show what's available to analyze
     - Identify relevant fields for user's goal
  3. Run field statistics (get_field_statistics):
     - Understand distribution of target field
     - Identify outliers and typical ranges
  4. Aggregate analysis (aggregate_by_field):
     - Bucket trades by parameter
     - Calculate win rate, avgPl, totalPl per bucket
     - Find optimal range
  5. Validate findings:
     - Check sample size per bucket
     - Warn about overfitting to small samples
     - Suggest walk-forward validation for significant findings

references/optimization.md:
- Difference between optimization and overfitting
- Sample size requirements
- Multiple testing problem (testing many parameters inflates false positives)
- How to validate optimization results
- When optimization is appropriate vs dangerous
  </action>
  <verify>ls packages/agent-skills/tradeblocks-optimize/ shows SKILL.md and references/</verify>
  <done>SKILL.md uses Report Builder tools for parameter optimization; optimization.md warns about overfitting</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All three skill directories exist under packages/agent-skills/
- [ ] Each SKILL.md has valid YAML frontmatter with name matching directory
- [ ] Each skill has at least one reference file
- [ ] SKILL.md files are under 300 lines each
- [ ] Skills use appropriate MCP tools for their purpose
</verification>

<success_criteria>
- Three skills created: tradeblocks-compare, tradeblocks-portfolio, tradeblocks-optimize
- All SKILL.md files follow Agent Skills standard
- Conversational workflow pattern with contextual branching
- Interpretation guidance included
- Reference files provide domain education
</success_criteria>

<output>
After completion, create `.planning/phases/14-multi-platform-agent-skills/14-02-SUMMARY.md`:

# Phase 14-02: Comparison & Portfolio Skills Summary

**[Brief description of what was created]**

## Accomplishments
- [Skills created with key features]

## Files Created
- packages/agent-skills/tradeblocks-compare/...
- packages/agent-skills/tradeblocks-portfolio/...
- packages/agent-skills/tradeblocks-optimize/...

## Decisions Made
[Key decisions and rationale]

## Issues Encountered
[Problems and resolutions]

## Next Step
Ready for 14-03-PLAN.md (documentation and installation)
</output>
