---
phase: 27-remove-manual-input
plan: 02
type: execute
---

<objective>
Remove riskFreeRate from stores, services, and UI components.

Purpose: Update application layer code to no longer pass or use riskFreeRate. This includes removing the user-facing input control from block-stats page.

Output: Stores, services, and UI no longer reference riskFreeRate. User cannot manually set risk-free rate.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./27-02-summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/27-remove-manual-input/27-01-PLAN.md

# Depends on Plan 01 completing the type definition changes

# Files to modify:
@lib/stores/block-store.ts
@lib/stores/performance-store.ts
@lib/services/performance-snapshot.ts
@lib/services/calendar-data.ts
@app/(platform)/block-stats/page.tsx
@app/(platform)/assistant/page.tsx
@components/block-dialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove riskFreeRate from stores and services</name>
  <files>lib/stores/block-store.ts, lib/stores/performance-store.ts, lib/services/performance-snapshot.ts, lib/services/calendar-data.ts</files>
  <action>
1. In `lib/stores/block-store.ts`:
   - Remove `riskFreeRate: processedBlock.analysisConfig?.riskFreeRate || 2.0,` (line ~520, ~537)
   - These are in the analysisConfig objects being created
   - Just remove the riskFreeRate lines, keep other config properties

2. In `lib/stores/performance-store.ts`:
   - Remove `const riskFreeRate = 2.0` declaration (line ~196)
   - Remove `riskFreeRate === 2.0` from condition (line ~204) - adjust the condition accordingly
   - Remove `riskFreeRate: 2.0,` from objects (line ~258, ~306)

3. In `lib/services/performance-snapshot.ts`:
   - Remove `riskFreeRate?: number` from options interface (line ~42)
   - Remove the line that extracts riskFreeRate from options (line ~123)
   - Remove riskFreeRate from PortfolioStatsCalculator constructor call (line ~188)
   - Just pass other config properties, not riskFreeRate

4. In `lib/services/calendar-data.ts`:
   - Remove `riskFreeRate: 2.0` from PortfolioStatsCalculator call (line ~1283)
   - Just use `new PortfolioStatsCalculator()` with default config
  </action>
  <verify>npm run typecheck shows no errors in these 4 files</verify>
  <done>Stores and services no longer reference riskFreeRate</done>
</task>

<task type="auto">
  <name>Task 2: Remove riskFreeRate from UI components</name>
  <files>app/(platform)/block-stats/page.tsx, app/(platform)/assistant/page.tsx, components/block-dialog.tsx</files>
  <action>
1. In `app/(platform)/block-stats/page.tsx`:
   - Remove `const [riskFreeRate, setRiskFreeRate] = useState("2");` (line ~61)
   - Remove the entire "Risk-free Rate (%)" input section (lines ~728-741):
     ```
     <div className="space-y-2">
       <Label htmlFor="risk-free-rate">Risk-free Rate (%)</Label>
       <Input ... />
     </div>
     ```
   - Remove `riskFreeRate` from all dependency arrays and usages throughout the file
   - Remove `riskFreeRate: parseFloat(riskFreeRate) || 2.0` from objects
   - Remove the CSV export line that includes riskFreeRate
   - Update PortfolioStatsCalculator calls to not pass riskFreeRate

2. In `app/(platform)/assistant/page.tsx`:
   - Remove `riskFreeRate: 2.0,` from PortfolioStatsCalculator calls (line ~113, ~120)

3. In `components/block-dialog.tsx`:
   - Remove `riskFreeRate: 0.05,` and `riskFreeRate: 2.0,` from all PortfolioStatsCalculator calls (lines ~1031, ~1104, ~1365, ~1419, ~1648)

Note: The UI change is user-facing - the block-stats page will no longer show a Risk-free Rate input. This is intentional as rates are now automatically determined by trade dates.
  </action>
  <verify>npm run build completes without TypeScript errors in these UI files</verify>
  <done>UI components no longer reference or allow setting riskFreeRate</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `lib/stores/block-store.ts` - No riskFreeRate references
- [ ] `lib/stores/performance-store.ts` - No riskFreeRate references
- [ ] `lib/services/performance-snapshot.ts` - No riskFreeRate in options or usage
- [ ] `lib/services/calendar-data.ts` - No riskFreeRate in calculator call
- [ ] `app/(platform)/block-stats/page.tsx` - No riskFreeRate state, input, or usage
- [ ] `app/(platform)/assistant/page.tsx` - No riskFreeRate in calculator calls
- [ ] `components/block-dialog.tsx` - No riskFreeRate in calculator calls
- [ ] `npm run build` succeeds (ignoring MCP and test files not yet updated)
</verification>

<success_criteria>
- All stores updated
- All services updated
- All UI components updated
- Risk-free rate input removed from block-stats page
- Application compiles and runs
</success_criteria>

<output>
After completion, create `.planning/phases/27-remove-manual-input/27-02-SUMMARY.md`
</output>
