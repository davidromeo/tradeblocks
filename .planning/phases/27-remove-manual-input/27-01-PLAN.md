---
phase: 27-remove-manual-input
plan: 01
type: execute
---

<objective>
Remove riskFreeRate from types, models, and core calculation files.

Purpose: Clean up the foundation layer that other code depends on. Since Phase 26 made the calculations use date-based Treasury rates, the riskFreeRate config is now dead code.

Output: Types and calculations no longer reference riskFreeRate parameter.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./27-01-summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/26-core-calculations/26-01-SUMMARY.md

# Key insight from Phase 26:
# - config.riskFreeRate is now ignored - date-based rates always used
# - Sharpe/Sortino now use getRiskFreeRate(date) lookup
# - This phase removes the now-unused parameter

# Files to modify:
@lib/models/portfolio-stats.ts
@lib/models/block.ts
@lib/models/validators.ts
@lib/calculations/portfolio-stats.ts
@lib/calculations/performance.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove riskFreeRate from type definitions</name>
  <files>lib/models/portfolio-stats.ts, lib/models/block.ts, lib/models/validators.ts</files>
  <action>
1. In `lib/models/portfolio-stats.ts`:
   - Remove `riskFreeRate: number` from the `AnalysisConfig` interface (line ~110)
   - Remove the comment about "Annual risk-free rate for Sharpe/Sortino calculations"

2. In `lib/models/block.ts`:
   - Remove `riskFreeRate: number;` from `ProcessedBlock.analysisConfig` type (line ~81)

3. In `lib/models/validators.ts`:
   - Remove `riskFreeRate: z.number().finite().min(0).max(20),` from `analysisConfigSchema` (line ~176)

Note: These are breaking changes to the type definitions. Downstream code will show TypeScript errors until they are also updated in subsequent tasks/plans.
  </action>
  <verify>TypeScript errors appear in files that still reference riskFreeRate - this is expected and will be fixed in subsequent tasks</verify>
  <done>AnalysisConfig no longer has riskFreeRate field in any type definition</done>
</task>

<task type="auto">
  <name>Task 2: Remove riskFreeRate from calculation files</name>
  <files>lib/calculations/portfolio-stats.ts, lib/calculations/performance.ts</files>
  <action>
1. In `lib/calculations/portfolio-stats.ts`:
   - Remove `riskFreeRate: 2.0, // 2% annual` from `DEFAULT_ANALYSIS_CONFIG` (line ~39)
   - The PortfolioStatsCalculator already uses getRiskFreeRate(date) since Phase 26, so no logic changes needed

2. In `lib/calculations/performance.ts`:
   - Find the function with `riskFreeRate: number = 0.02` parameter (line ~216)
   - This is the `calculateSharpeRatio` function signature
   - Remove the `riskFreeRate` parameter entirely
   - Update the function body to use `getRiskFreeRate(date)` if dates are available, or use a constant for backward compatibility
   - Check all callers of this function in the codebase

IMPORTANT: Check if performance.ts calculateSharpeRatio is actually used anywhere or if it's dead code (portfolio-stats.ts has its own implementation).
  </action>
  <verify>npm run build succeeds with TypeScript errors only in files not yet updated (stores, services, UI, MCP, tests)</verify>
  <done>DEFAULT_ANALYSIS_CONFIG and calculation functions no longer reference riskFreeRate</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `lib/models/portfolio-stats.ts` - AnalysisConfig has no riskFreeRate
- [ ] `lib/models/block.ts` - ProcessedBlock.analysisConfig has no riskFreeRate
- [ ] `lib/models/validators.ts` - analysisConfigSchema has no riskFreeRate
- [ ] `lib/calculations/portfolio-stats.ts` - DEFAULT_ANALYSIS_CONFIG has no riskFreeRate
- [ ] `lib/calculations/performance.ts` - Functions don't accept riskFreeRate parameter
- [ ] TypeScript shows expected errors in downstream files (not a failure - expected until Plan 02/03)
</verification>

<success_criteria>
- All type definitions updated
- Core calculation files updated
- TypeScript compiles these specific files without errors
- Foundation is ready for Plan 02 (stores/services/UI cleanup)
</success_criteria>

<output>
After completion, create `.planning/phases/27-remove-manual-input/27-01-SUMMARY.md`
</output>
