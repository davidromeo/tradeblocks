---
phase: 08-interpretation-guidance
plan: 03
type: execute
---

<objective>
Add configuration-aware warnings to help users distinguish strategy issues from configuration issues.

Purpose: ISS-003 identified that the Analysis tab only evaluates output metrics and can't distinguish "strategy is overfit" from "configuration was too aggressive." Users may blame strategies when poor results stem from aggressive window configurations.

Output: Configuration Observations section in Analysis tab that flags short windows, aggressive IS/OOS ratios, and other config-driven concerns.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-interpretation-guidance/08-01-SUMMARY.md
@.planning/phases/08-interpretation-guidance/08-02-SUMMARY.md
@.planning/phases/08-interpretation-guidance/08-RESEARCH.md

**Key files:**
@lib/calculations/walk-forward-interpretation.ts
@components/walk-forward/walk-forward-analysis.tsx
@lib/models/walk-forward.ts

**Tech stack available:**
- Existing interpretation module pattern (generateVerdictExplanation, detectRedFlags, generateInsights)
- Assessment-based color coding (emerald/amber/rose)
- Conditional section rendering

**Established patterns:**
- Plain-language interpretation without jargon
- "suggests/indicates/may mean" language for observations
- Severity levels: warning (investigate) vs concern (problematic)

**Constraining decisions:**
- Phase 08-01: Use non-prescriptive language ("suggests/indicates")
- Phase 08-01: Red flags have 2 severity levels (warning/concern)
- Phase 08-02: Configuration-awareness deferred to this plan

**Issue being addressed:** ISS-003
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add configuration observation function to interpretation module</name>
  <files>lib/calculations/walk-forward-interpretation.ts</files>
  <action>
Add a new exported interface and function:

1. Add `ConfigurationObservation` interface:
   - `severity: 'info' | 'warning'` (info = worth knowing, warning = may affect results)
   - `title: string`
   - `description: string`

2. Add `detectConfigurationObservations(config: WalkForwardConfig, results: WalkForwardResults): ConfigurationObservation[]` function that checks:

   **Short IS window** (warning): `inSampleDays < 21`
   - "In-sample window is short (Xd)"
   - "With only X days of training data per window, the optimizer may not have enough information to find robust patterns. Consider increasing to 30+ days."

   **Short OOS window** (warning): `outOfSampleDays < 7`
   - "Out-of-sample window is short (Xd)"
   - "With only X days of testing data, results may be noisy. A longer testing period (14+ days) provides more confidence."

   **Aggressive IS/OOS ratio** (warning): `inSampleDays / outOfSampleDays > 4`
   - "High IS/OOS ratio (X:1)"
   - "Using X times more training data than testing data increases overfitting risk. Ratios of 2:1 to 3:1 are more balanced."

   **Many windows from short data** (info): `periods.length >= 10 && (inSampleDays + outOfSampleDays) < 30`
   - "Many short windows (X windows of Y days each)"
   - "Running many short windows can produce noisy results. Each window may capture different market regimes."

   **Few periods** (info): `periods.length < 4`
   - "Limited test periods (X windows)"
   - "With only X periods, the sample size is small. Results may not generalize well to other time periods."

Return empty array if no observations apply. Keep language non-prescriptive ("may", "consider", "can").
  </action>
  <verify>TypeScript compiles without errors: `npm run typecheck`</verify>
  <done>Function exported and type-safe, covers 5 configuration patterns</done>
</task>

<task type="auto">
  <name>Task 2: Add Configuration Observations section to Analysis component</name>
  <files>components/walk-forward/walk-forward-analysis.tsx</files>
  <action>
1. Import `detectConfigurationObservations` from interpretation module
2. Import `Settings2` icon from lucide-react (for configuration section)

3. Add to `interpretationData` useMemo:
   - Call `detectConfigurationObservations(/* need config */)` - but WalkForwardAnalysis only receives `results`, not `config`

   **Resolution:** The WalkForwardAnalysis component is rendered in page.tsx which has access to `results.config` via the analysis object. Update the component to accept config:
   - Change props interface to include `config: WalkForwardConfig`
   - In page.tsx, pass `results.results.config` (from WalkForwardAnalysis object)

   Actually, looking at the data model: `WalkForwardAnalysis` has `config` and `results`. The component receives `WalkForwardResults` but needs `WalkForwardConfig`.

   **Better approach:** Update component props to accept `WalkForwardAnalysis` instead of `WalkForwardResults`, then extract both config and results internally. This matches what the page has access to.

4. Update component signature:
   - Change `WalkForwardAnalysisProps` to accept `analysis: WalkForwardAnalysis`
   - Extract `results` and `config` from the analysis object
   - Update all internal references from `results` to the extracted variable

5. Add configObservations to useMemo:
   ```tsx
   configObservations: detectConfigurationObservations(config, results),
   ```

6. Add Configuration Observations section between "Why This Verdict" and "Things to Note":
   - Only render if `configObservations.length > 0`
   - Use Settings2 icon with muted foreground color
   - Title: "Configuration Notes"
   - Map observations similar to red flags but with:
     - info severity: `bg-slate-500/5 border-slate-500/20` text `text-slate-700 dark:text-slate-400`
     - warning severity: `bg-amber-500/5 border-amber-500/20` (same as red flag warnings)

7. Update page.tsx where WalkForwardAnalysis is used:
   - Change `<WalkForwardAnalysis results={...} />` to `<WalkForwardAnalysis analysis={...} />`
   - Pass the full analysis object (which contains both config and results)
  </action>
  <verify>
1. `npm run typecheck` passes
2. Component renders without errors (visual verification deferred)
  </verify>
  <done>
- Component accepts analysis object with config
- Configuration Observations section renders when observations exist
- Uses consistent styling (slate for info, amber for warnings)
- Page.tsx updated to pass full analysis object
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run typecheck` passes
- [ ] `npm run build` succeeds
- [ ] New function exported from interpretation module
- [ ] Component properly typed with WalkForwardAnalysis prop
</verification>

<success_criteria>

- Configuration observation function detects 5 patterns
- Analysis component shows "Configuration Notes" section when relevant
- Non-prescriptive language throughout ("may", "consider")
- No TypeScript errors
- Phase 8 complete
</success_criteria>

<output>
After completion, create `.planning/phases/08-interpretation-guidance/08-03-SUMMARY.md`:

# Phase 8 Plan 3: Configuration-Aware Warnings Summary

**[Substantive one-liner]**

## Performance

- **Duration:** X min
- **Started:** [timestamp]
- **Completed:** [timestamp]
- **Tasks:** 2
- **Files modified:** 3

## Accomplishments

- [Key outcomes]

## Task Commits

1. **Task 1:** [commit hash] (feat)
2. **Task 2:** [commit hash] (feat)

## Files Created/Modified

- `lib/calculations/walk-forward-interpretation.ts` - Added detectConfigurationObservations
- `components/walk-forward/walk-forward-analysis.tsx` - Added Configuration Notes section
- `app/(platform)/walk-forward/page.tsx` - Updated to pass full analysis object

## Decisions Made

[Key decisions]

## Deviations from Plan

[Any deviations]

## Issues Encountered

[Problems and resolutions]

## Next Phase Readiness

- Phase 8 (Interpretation Guidance) complete
- ISS-003 resolved
- Ready for Phase 9 (Calculation Robustness)

---
*Phase: 08-interpretation-guidance*
*Completed: [date]*
</output>
