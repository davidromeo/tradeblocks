# Milestone v2.3: Workspace Packages

**Status:** ✅ SHIPPED 2026-01-19
**Phases:** 29-31
**Total Plans:** 4

## Overview

Convert `lib/` to a proper workspace package (`@tradeblocks/lib`) to fix TypeScript path resolution issues and enable clean imports across the monorepo. Eliminates fragile `@/lib/*` path aliases and esbuild workarounds in favor of standard npm workspace package resolution.

## Phases

### Phase 29: workspace-setup

**Goal**: Create `@tradeblocks/lib` package with workspace config
**Depends on**: v2.2 milestone complete
**Plans**: 1/1 complete

Plans:
- [x] 29-01: Create package structure, move lib/, verify workspace resolution

**Details:**
- Created @tradeblocks/lib package with proper package.json, tsconfig.json, and barrel exports
- Moved all lib/ content (10 subdirectories, 81 files) to packages/lib/
- Updated internal imports from @/lib/* to relative paths within the package
- Verified workspace symlink: node_modules/@tradeblocks/lib -> ../../packages/lib

### Phase 30: import-migration

**Goal**: Update all imports in Next.js app and MCP server to use package imports
**Depends on**: Phase 29
**Plans**: 2/2 complete

Plans:
- [x] 30-01: MCP server imports (6 files + config cleanup)
- [x] 30-02: Next.js app imports (127 files in app/ + components/)

**Details:**
- MCP server: Changed to bundler moduleResolution, removed esbuild @lib alias workarounds
- App/Components: Migrated 127+ files from @/lib/* to @tradeblocks/lib
- Added complete barrel exports for all lib submodules (utils, stores, data, services, metrics, types)
- Stores use separate entry point: `@tradeblocks/lib/stores`

### Phase 31: cleanup-verification

**Goal**: Remove old path alias configs, verify type checking/build/tests pass
**Depends on**: Phase 30
**Plans**: 1/1 complete

Plans:
- [x] 31-01: Migrate remaining imports, remove @/lib/* alias, verify builds

**Details:**
- Migrated 62 test files to @tradeblocks/lib imports
- Added Jest moduleNameMapper for workspace package resolution
- Removed @/lib/* path alias from tsconfig.json entirely
- Fixed naming conflicts (ProcessingResult → DataLoadingResult)
- Verified: npm run build passes, 1024 tests pass (65 test suites)

---

## Milestone Summary

**Key Decisions:**
- Direct TS source consumption (no build step) for internal workspace packages
- Changed MCP server moduleResolution from Node16 to bundler for workspace resolution
- Stores excluded from main lib export (browser dependencies, Block interface collision)
- Merged utils.ts into utils/index.ts to fix module shadowing

**Issues Resolved:**
- Fixed TypeScript path resolution issues in MCP server
- Eliminated fragile @lib/* path aliases and esbuild alias workarounds
- Resolved export naming conflicts (findOptimalThreshold, ProcessingResult)

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- None - this milestone specifically paid down technical debt from the previous import system

---

_For current project status, see .planning/ROADMAP.md_
