# Milestone v2.8: Market Data Consolidation

**Status:** SHIPPED 2026-02-07
**Phases:** 51-54
**Total Plans:** 5

## Overview

Four phases consolidate the market data pipeline from 6 PineScripts to 3, merge highlow timing into the daily export via `request.security_lower_tf()`, enrich with 7 new VIX fields aligned to Option Omega filters, unify the DuckDB import path by retiring in-memory CSV loading, and update all documentation to reflect the final architecture.

## Phases

### Phase 51: PineScript Consolidation

**Goal**: Daily PineScript produces a single combined CSV with highlow timing, enriched VIX fields, and all existing daily data
**Depends on**: Nothing (first phase of v2.8)
**Plans**: 2 plans

Plans:
- [x] 51-01-PLAN.md -- Merge highlow timing + enriched VIX exports into spx-daily.pine
- [x] 51-02-PLAN.md -- Delete obsolete scripts + update README for 3-script workflow

**Details:**
- Requirements: PINE-01 through PINE-09
- Merged highlow timing computation into daily script using `request.security_lower_tf()` with 5-min intrabar data
- Added 7 VIX enrichment fields (VIX_Gap_Pct, VIX9D_Open, VIX9D_Change_Pct, VIX_High, VIX_Low, VIX3M_Open, VIX3M_Change_Pct)
- Deleted 3 scripts: spx-highlow-timing.pine, spx-30min-checkpoints.pine, spx-hourly-checkpoints.pine
- Rewrote scripts/README.md for 3-script workflow

### Phase 52: DuckDB Schema + Sync

**Goal**: DuckDB schema absorbs highlow and new VIX columns into `spx_daily`, sync handles the combined CSV, and the `spx_highlow` table is retired
**Depends on**: Phase 51 (needs combined CSV format defined)
**Plans**: 1 plan

Plans:
- [x] 52-01-PLAN.md -- Schema migration, sync config, reference cleanup, version bump

**Details:**
- Requirements: SCHEMA-01 through SCHEMA-04, SYNC-01 through SYNC-03
- Expanded spx_daily from ~35 to 55 columns (13 highlow + 7 VIX additions)
- Dropped spx_highlow table and removed CSV mapping
- Updated column descriptions for describe_database tool
- MCP server: 0.9.0 -> 0.10.0

### Phase 53: Import Consolidation

**Goal**: All market data tools query DuckDB exclusively, eliminating the in-memory CSV loading path
**Depends on**: Phase 52 (needs DuckDB schema and sync working)
**Plans**: 1 plan

Plans:
- [x] 53-01-PLAN.md -- Migrate 3 tools to DuckDB queries, remove CSV loading infrastructure, version bump

**Details:**
- Requirements: IMPORT-01 through IMPORT-05
- Migrated analyze_regime_performance, suggest_filters, calculate_orb to DuckDB queries
- Removed in-memory CSV loading functions and 5-min TTL cache from market-data.ts
- MCP server: 0.10.0 -> 0.10.1

### Phase 54: Documentation + Cleanup

**Goal**: All documentation reflects the new 3-script, DuckDB-only architecture and PoC artifacts are removed
**Depends on**: Phase 53 (needs final architecture settled)
**Plans**: 1 plan

Plans:
- [x] 54-01-PLAN.md -- Delete PoC files, update CLAUDE.md and planning docs, close v2.8 milestone

**Details:**
- Requirements: DOCS-01, DOCS-02
- Deleted PoC test files (scripts/poc test/ and poc Pine script)
- Updated CLAUDE.md: removed get_market_context references, replaced includeIntraday/flatten tips with DuckDB guidance
- Updated PROJECT.md, REQUIREMENTS.md, ROADMAP.md, MILESTONES.md, STATE.md

---

## Milestone Summary

**Key Decisions:**
- Merge highlow into daily script via `request.security_lower_tf()`: 5x history depth, one fewer export for users
- Export computed-but-hidden VIX fields aligned with Option Omega filters: enables same filter analysis
- Consolidate dual import to DuckDB-only: eliminate redundant in-memory CSV loading, single data path
- Absorb spx_highlow into spx_daily: simpler schema, one fewer table to maintain

**Issues Resolved:**
- None significant

**Issues Deferred:**
- VVIX and SKEW index data -- not needed for OO alignment
- Put/call ratio (USI:PCC) -- deferred
- Intraday checkpoint computation via lower_tf on daily chart -- potential future optimization

**Technical Debt Incurred:**
- None identified

---

_For current project status, see .planning/ROADMAP.md_
