# Milestone v2.5: Reporting Log Integration & Discrepancy Analysis

**Status:** ✅ SHIPPED 2026-02-01
**Phases:** 35-39
**Total Plans:** 5

## Overview

Enable AI models to ingest reporting logs, compare backtest vs actual results at trade level, and analyze discrepancy patterns — all via MCP. Quality scoring dropped — existing tools provide metrics; AI synthesizes.

## Phases

### Phase 35: Reporting Log Ingestion

**Goal**: Model can load and parse reporting logs (strategylog.csv) for a block via MCP
**Depends on**: Nothing (foundation for v2.5)
**Plans**: 1 plan

Plans:
- [x] 35-01-PLAN.md — Enhance list_blocks with hasReportingLog flag, add get_reporting_log_stats tool with caching

**Details:**
- Added hasReportingLog flag to BlockInfo for quick discovery
- New get_reporting_log_stats tool with per-strategy breakdown (tradeCount, winRate, totalPL, avgPL, contractCount)
- Stats cached in block.json with mtime-based invalidation

### Phase 36: Enhanced Comparison

**Goal**: Model can get detailed trade-level comparison between backtest and actual results
**Depends on**: Phase 35
**Plans**: 1 plan

Plans:
- [x] 36-01-PLAN.md — Enhance compare_backtest_to_actual with detailLevel, outlier detection, and groupBy parameters

**Details:**
- Added 4 new parameters: detailLevel, outliersOnly, outliersThreshold, groupBy
- Z-score outlier detection with severity levels (low/medium/high)
- Grouping by strategy, date, week, or month with per-group statistics
- Trade matching by date|strategy|time (minute precision)

### Phase 37: Discrepancy Analysis

**Goal**: Model can classify slippage sources and identify systematic patterns
**Depends on**: Phase 36
**Plans**: 1 plan

Plans:
- [x] 37-01-PLAN.md — Implement analyze_discrepancies MCP tool with slippage attribution, pattern detection, and market correlations

**Details:**
- Decompose slippage into 5 categories: entry price, exit price, size, timing, unexplained
- Detect systematic patterns: direction bias, category concentration, time-of-day clustering, VIX sensitivity
- Correlations with market conditions using Pearson or Kendall methods
- Per-strategy breakdown when requested

### Phase 38: Strategy Matching

**Goal**: Model can get suggested strategy matches and detect unmatchable divergence
**Depends on**: Phase 36
**Plans**: 1 plan

Plans:
- [x] 38-01-PLAN.md — Implement suggest_strategy_matches MCP tool with correlation-based matching, confidence scores, and unmatchable detection

**Details:**
- Support for Pearson, Spearman, and Kendall correlation methods
- Per-contract P/L normalization for fair comparison
- Confidence scores (0-100) combining correlation strength (70%) and timing overlap (30%)
- Unmatchable detection for negative correlation (<-0.2) or systematic bias (>2 std devs)

### Phase 39: Trend Analysis

**Goal**: Model can analyze slippage trends over time and detect improvement/degradation
**Depends on**: Phase 37
**Plans**: 1 plan

Plans:
- [x] 39-01-PLAN.md — Implement analyze_slippage_trends MCP tool with linear regression trend detection and external factor correlation

**Details:**
- Linear regression with p-value (normal approximation) and R-squared
- Trend interpretation: improving (negative slope + significant), stable (not significant), degrading (positive slope + significant)
- Time-series aggregation by daily/weekly/monthly granularity
- Optional VIX correlation analysis

---

## Milestone Summary

**Dropped Requirements:**
Phase 40 (Quality Scoring) was dropped because:
- Existing tools (compare_backtest_to_actual, analyze_discrepancies, analyze_slippage_trends) provide all necessary metrics
- AI synthesizes quality assessment from these tools rather than prescriptive scores
- Avoids opinionated scoring that may not match user's criteria

**Key Decisions:**
- Per-contract P/L normalization for fair strategy comparison
- Z-score threshold of 2 for outlier detection (~95% confidence)
- Confidence scoring: 70% correlation + 30% timing overlap
- Linear regression with normal approximation for p-value (normalCDF from lib)
- Trend significance threshold: p < 0.05
- "Insights, not recommendations" — tools provide data, not prescriptive scores

**Issues Resolved:**
- Trade matching handles fractional seconds in actual trades (truncate to minute)
- Slippage attribution correctly calculates exit price impact for credit positions
- Percentage calculations use gross impact for meaningful totals

**Issues Deferred:**
None

**Technical Debt Incurred:**
None identified - implementation quality is high across all phases

---

_For current project status, see .planning/ROADMAP.md_
