# Milestone v2.4: Backtest Optimization Tools

**Status:** ✅ SHIPPED 2026-01-19
**Phases:** 32-34
**Total Plans:** 3

## Overview

MCP tools that help users identify which entry conditions predict trade success, enabling data-driven filter optimization for backtests.

## Phases

### Phase 32: find-predictive-fields

**Goal**: Tool that scans all numeric fields, calculates correlation with P/L, and returns ranked list of predictive factors
**Depends on**: Previous milestone complete
**Plans**: 1 plan

Plans:
- [x] 32-01: find_predictive_fields MCP tool — completed 2026-01-19

**Details:**
- Pearson correlation-based analysis ranking all numeric fields by P/L correlation
- Interpretation labels (strong/moderate/weak/negligible) based on |r| thresholds
- Support for strategy, date range, and custom fields filtering
- Runtime defaults pattern established for Zod schema handling

### Phase 33: filter-curve

**Goal**: Tool that sweeps thresholds for a field with bidirectional analysis (lt/gt/both modes), returns full outcome curve, and surfaces sweet spots
**Depends on**: Phase 32
**Plans**: 1 plan

Plans:
- [x] 33-01: filter_curve MCP tool — completed 2026-01-19

**Details:**
- Bidirectional threshold analysis (lt/gt/both modes)
- Auto-generated thresholds from percentiles [5, 10, 25, 50, 75, 90, 95]
- Custom threshold support overrides auto-generation
- Sweet spot detection with combined improvement scoring (winRateDelta * avgPlDelta)
- Full strategy/date pre-filter support

### Phase 34: report-tools-fixes

**Goal**: Fix Zod default parameters not applying in MCP SDK CLI mode for report tools
**Depends on**: Phase 33
**Plans**: 1 plan

Plans:
- [x] 34-01: Fix runtime defaults for aggregate_by_field, run_filtered_query, get_field_statistics — completed 2026-01-19

**Details:**
- Identified root cause: CLI --call handler bypassed Zod parsing
- Fixed cli-handler.ts to call inputSchema.safeParse() before invoking tool handlers
- Removed runtime default workarounds from 5 tools (cleaner codebase)

---

## Milestone Summary

**Key Decisions:**
- Fix at CLI handler level rather than patching each tool individually
- Sweet spot criteria: winRateDelta > 0 AND avgPlDelta > 0 AND percentOfTrades >= 20%
- Use Pearson correlation for linear relationship detection
- Rank by absolute correlation (both positive and negative are predictive)

**Issues Resolved:**
- CLI --call mode now applies Zod schema parsing like normal MCP server mode
- All current and future tools work correctly in CLI test mode without per-tool workarounds

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- None

---

_For current project status, see .planning/ROADMAP.md_
